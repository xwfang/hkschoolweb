import{t as e}from"./useQuery-CdUfq68C.js";import{t}from"./useMutation-BkN4UQJT.js";import{n,r,t as i}from"./schools-BwIbxADS.js";import{t as a}from"./plus-AELA-y7R.js";import{t as o}from"./school-CCxEkm5f.js";import{I as s,P as c,a as l,c as u,j as d,l as f,n as p,o as m,s as h}from"./index-C5DmB-Kt.js";import"./middleware-BBcUew7W.js";import{t as g}from"./auth-DtMUInPJ.js";import{n as _,t as v}from"./card-DHSGMcZ6.js";import"./client-CpsTSz5c.js";import{t as y}from"./button-z2l9a-8-.js";import{t as b}from"./use-metadata-BeOtXiAy.js";import{t as x}from"./input-B-brlY61.js";import{t as S}from"./children-Cf6TdtO5.js";import{t as C}from"./applications-CUbfwuir.js";var w=h(`award`,[[`path`,{d:`m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526`,key:`1yiouv`}],[`circle`,{cx:`12`,cy:`8`,r:`6`,key:`1vp47v`}]]),T=h(`chevron-down`,[[`path`,{d:`m6 9 6 6 6-6`,key:`qrunsl`}]]),E=h(`map-pin`,[[`path`,{d:`M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0`,key:`1r0f0z`}],[`circle`,{cx:`12`,cy:`10`,r:`3`,key:`ilqhr7`}]]),D=h(`search`,[[`path`,{d:`m21 21-4.34-4.34`,key:`14j7rj`}],[`circle`,{cx:`11`,cy:`11`,r:`8`,key:`4ej97u`}]]),O=c(),k=f();function A(){let{t}=p(),{currentChildId:n,setCurrentChildId:r}=g(),i=d(),[o,s]=(0,O.useState)(!1),{data:c}=e({queryKey:[`children`],queryFn:S.list}),u=c?.find(e=>e.id===n);return(0,k.jsxs)(`div`,{className:`relative`,children:[(0,k.jsxs)(`div`,{className:`flex items-center gap-2 cursor-pointer active:opacity-70`,onClick:()=>s(!o),children:[(0,k.jsx)(`div`,{className:`h-8 w-8 bg-indigo-100 rounded-full flex items-center justify-center border border-indigo-200`,children:(0,k.jsx)(l,{className:`h-4 w-4 text-indigo-600`})}),(0,k.jsx)(`div`,{children:(0,k.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,k.jsx)(`h2`,{className:`text-base font-bold text-gray-900 leading-none`,children:u?u.name:t(`profile.all_children`)}),(0,k.jsx)(T,{className:`h-4 w-4 text-gray-400 transition-transform ${o?`rotate-180`:``}`})]})})]}),o&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(`div`,{className:`fixed inset-0 z-40`,onClick:()=>s(!1)}),(0,k.jsxs)(`div`,{className:`absolute top-full left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-50 py-1 animate-in fade-in zoom-in-95 duration-200`,children:[(0,k.jsxs)(`div`,{className:`px-4 py-2 text-sm hover:bg-gray-50 cursor-pointer flex items-center justify-between ${n?`text-gray-700`:`bg-indigo-50 text-indigo-700 font-medium`}`,onClick:()=>{r(null),s(!1)},children:[(0,k.jsx)(`span`,{children:t(`profile.all_children`)}),!n&&(0,k.jsx)(`div`,{className:`h-1.5 w-1.5 rounded-full bg-indigo-600`})]}),c?.map(e=>(0,k.jsxs)(`div`,{className:`px-4 py-2 text-sm hover:bg-gray-50 cursor-pointer flex items-center justify-between ${n===e.id?`bg-indigo-50 text-indigo-700 font-medium`:`text-gray-700`}`,onClick:()=>{r(e.id),s(!1)},children:[(0,k.jsx)(`span`,{children:e.name}),n===e.id&&(0,k.jsx)(`div`,{className:`h-1.5 w-1.5 rounded-full bg-indigo-600`})]},e.id)),(0,k.jsx)(`div`,{className:`border-t mt-1 pt-1`,children:(0,k.jsxs)(y,{variant:`ghost`,size:`sm`,className:`w-full justify-start text-xs text-gray-500 h-9 px-4`,onClick:()=>{i(`/app/profile/add-child`),s(!1)},children:[(0,k.jsx)(a,{className:`h-3 w-3 mr-2`}),t(`child.add_title`)]})})]})]})]})}function j(){let{t:a,i18n:s}=p(),{getDistrictLabel:c,getGenderLabel:f,getCategoryLabel:h,getTagLabel:T,districts:j,categories:M,genders:N}=b(),{currentChildId:P}=g(),[F,I]=(0,O.useState)(``),[L,R]=(0,O.useState)(``),z=u(),B=d(),{data:V}=e({queryKey:[`children`],queryFn:S.list,enabled:!!P}),H=V?.find(e=>e.id===P),U=(e=>e?e.startsWith(`K`)?`Kindergarten`:e.startsWith(`P`)?`Primary`:`Secondary`:`Secondary`)(H?.current_grade),W=(()=>{let e=[];U===`Secondary`&&e.push({label:a(`home.band_1`),icon:w,value:`Band 1`,type:`banding`});let t=[`kowloon_city`,`wan_chai`,`central_western`];j.filter(e=>t.includes(e.key)).forEach(t=>{e.push({label:c(t.key),icon:E,value:t.key,type:`district`})});let n=[`secondary_dss`,`primary_aided`,`kindergarten_non_profit`];return M.filter(e=>n.some(t=>e.key.includes(t)||e.key===t)).forEach(t=>{t.key.toLowerCase().includes(U.toLowerCase())&&e.push({label:h(t.key),icon:o,value:t.key,type:`category`})}),(U===`Secondary`||U===`Primary`)&&N.forEach(t=>{let n=t.key;t.key===`boys`&&(n=`Boys`),t.key===`girls`&&(n=`Girls`),t.key===`co_ed`&&(n=`Co-ed`),e.push({label:f(t.key),icon:l,value:n,type:`gender`})}),e})(),G=()=>{let e=W.find(e=>e.value===L);return e?{[e.type]:e.value}:{}},{data:K,isLoading:q}=e({queryKey:[`matches`,P],queryFn:()=>P?S.getMatches(P):null,enabled:!!P&&!F&&!L}),{data:J}=e({queryKey:[`schools`,F,L],queryFn:()=>i.list({name:F,sort:F?void 0:`popularity`,...G()}),enabled:!P||!!F||!!L||!!P&&!q&&(!K?.matches||K.matches.length===0)}),{data:Y}=e({queryKey:[`applications`,P],queryFn:()=>P?C.list(P):null,enabled:!!P}),X=new Set(Y?.map(e=>e.school_id)),Z=t({mutationFn:C.create,onSuccess:()=>{z.invalidateQueries({queryKey:[`applications`]})}}),ee=e=>{if(!P){alert(a(`common.select_child_alert`));return}Z.mutate({child_id:P,school_id:e,status:`interested`})},te=e=>{L===e?R(``):(R(e),I(``))},Q=F||L?J:P&&K?.matches&&K.matches.length>0?K.matches:J,$=!F&&!L&&P&&(!K?.matches||K.matches.length===0);return(0,k.jsxs)(`div`,{className:`space-y-6 pb-20`,children:[(0,k.jsxs)(`div`,{className:`bg-white px-4 pt-4 pb-2 sticky top-0 z-10 border-b`,children:[(0,k.jsxs)(`div`,{className:`flex items-center gap-2 mb-4`,children:[(0,k.jsx)(A,{}),H&&(0,k.jsx)(`span`,{className:`text-[10px] font-medium px-2 py-0.5 bg-indigo-50 text-indigo-600 rounded-full border border-indigo-100`,children:a(U===`Kindergarten`?`child.level.kindergarten`:U===`Primary`?`child.level.primary`:`child.level.secondary`)})]}),(0,k.jsxs)(`div`,{className:`relative`,children:[(0,k.jsx)(D,{className:`absolute left-3 top-2.5 h-4 w-4 text-gray-400`}),(0,k.jsx)(x,{className:`pl-9 bg-gray-50 border-none shadow-sm h-9`,placeholder:a(`home.search_placeholder`),value:F,onChange:e=>{I(e.target.value),R(``)}})]})]}),(0,k.jsxs)(`div`,{className:`px-4 space-y-6`,children:[(0,k.jsx)(`section`,{children:(0,k.jsx)(`div`,{className:`flex gap-3 overflow-x-auto pb-2 scrollbar-hide`,children:W.map(e=>(0,k.jsxs)(`button`,{onClick:()=>te(e.value),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all duration-200 border ${L===e.value?`bg-indigo-600 text-white border-indigo-600 shadow-md scale-105`:`bg-white text-gray-600 border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 active:scale-95`}`,children:[(0,k.jsx)(e.icon,{className:`h-3.5 w-3.5`}),e.label]},e.label))})}),!F&&!L&&K?.analysis&&(0,k.jsx)(`section`,{className:`bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-4 text-white shadow-lg hover:shadow-xl transition-shadow duration-300 animate-fade-in`,children:(0,k.jsxs)(`div`,{className:`flex items-start gap-3`,children:[(0,k.jsx)(`div`,{className:`bg-white/20 p-2 rounded-lg backdrop-blur-sm shadow-sm`,children:(0,k.jsx)(m,{className:`h-5 w-5 text-white`})}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`h3`,{className:`font-bold text-sm mb-1`,children:a(`home.ai_recommendation`)}),(0,k.jsx)(`p`,{className:`text-xs text-indigo-100 leading-relaxed opacity-90 line-clamp-3`,children:K.analysis})]})]})}),$&&(0,k.jsxs)(`div`,{className:`bg-gradient-to-r from-orange-50 to-amber-50 text-orange-800 text-xs px-4 py-3 rounded-lg flex items-center gap-2 border border-orange-200 shadow-sm`,children:[(0,k.jsx)(`div`,{className:`bg-orange-100 rounded-full p-1.5`,children:(0,k.jsx)(`span`,{className:`text-base`,children:`ðŸ’¡`})}),(0,k.jsx)(`p`,{className:`flex-1`,children:a(`home.no_matches_fallback`,`æš‚æ— é’ˆå¯¹è¯¥å­å¥³çš„ä¸ªæ€§åŒ–åŒ¹é…ï¼Œä¸ºæ‚¨å±•ç¤ºçƒ­é—¨å­¦æ ¡ã€‚`)})]}),(0,k.jsxs)(`section`,{className:`space-y-3`,children:[(0,k.jsx)(`h2`,{className:`text-lg font-bold text-gray-900`,children:a(F||L?`home.filter_results`:$?`home.popular_schools`:`home.recommended_for_you`)}),(0,k.jsxs)(`div`,{className:`space-y-3`,children:[q?(0,k.jsxs)(`div`,{className:`text-center text-sm text-gray-500 py-8`,children:[(0,k.jsx)(`div`,{className:`animate-spin h-6 w-6 border-2 border-indigo-600 border-t-transparent rounded-full mx-auto mb-2`}),(0,k.jsx)(`p`,{className:`animate-pulse`,children:a(`home.loading`)})]}):Q?.map(e=>{let t=X.has(e.id),i=s.language===`en`,o=i?e.name_en||e.name_cn:e.name_cn||e.name_en,u=i?e.name_cn:e.name_en;return(0,k.jsx)(v,{className:`cursor-pointer active:scale-[0.98] overflow-hidden border-none shadow-sm ring-1 ring-gray-100 hover:ring-indigo-200 hover:shadow-md transition-all duration-200`,onClick:()=>B(`/app/school/${e.id}`),children:(0,k.jsx)(_,{className:`p-0`,children:(0,k.jsxs)(`div`,{className:`p-3 flex justify-between items-start gap-3`,children:[(0,k.jsxs)(`div`,{className:`flex-1 text-left`,children:[(0,k.jsxs)(`div`,{className:`flex items-center gap-2 mb-1`,children:[(0,k.jsx)(`h3`,{className:`font-bold text-gray-900 line-clamp-1 text-left`,children:o}),e.banding&&(0,k.jsx)(`span`,{className:`shrink-0 bg-indigo-50 text-indigo-700 text-[10px] font-bold px-1.5 py-0.5 rounded uppercase`,children:e.banding})]}),(0,k.jsx)(`p`,{className:`text-xs text-gray-500 mb-2 line-clamp-1 text-left`,children:u}),(0,k.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[e.popularity!==void 0&&(0,k.jsxs)(`div`,{className:`flex items-center gap-1 text-xs text-orange-600 bg-orange-50 px-2 py-0.5 rounded font-medium`,children:[(0,k.jsx)(r,{className:`h-3 w-3 fill-orange-200`}),e.popularity]}),(0,k.jsxs)(`div`,{className:`flex items-center gap-1 text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded`,children:[(0,k.jsx)(E,{className:`h-3 w-3`}),c(e.district)]}),(0,k.jsxs)(`div`,{className:`flex items-center gap-1 text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded`,children:[(0,k.jsx)(l,{className:`h-3 w-3`}),f(e.gender)]}),e.tags&&e.tags.split(`,`).slice(0,2).map((t,r)=>(0,k.jsxs)(`div`,{className:`flex items-center gap-1 text-xs text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded border border-indigo-100`,children:[(0,k.jsx)(n,{className:`h-3 w-3`}),T(t.trim())]},`${e.id}-tag-${r}`))]})]}),(0,k.jsx)(y,{size:`sm`,variant:t?`secondary`:`outline`,className:`h-8 px-3 shrink-0 transition-all ${t?`bg-green-50 text-green-700 hover:bg-green-100 border-green-200`:``}`,disabled:t||Z.isPending,onClick:t=>{t.stopPropagation(),ee(e.id)},children:a(t?`common.followed`:`common.follow`)})]})})},e.id)}),Q?.length===0&&(0,k.jsxs)(`div`,{className:`text-center text-gray-500 py-16 bg-gradient-to-b from-gray-50 to-white rounded-xl border-2 border-dashed border-gray-200`,children:[(0,k.jsx)(`div`,{className:`bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4`,children:(0,k.jsx)(o,{className:`h-8 w-8 text-indigo-500`})}),(0,k.jsx)(`p`,{className:`text-base font-medium text-gray-700 mb-1`,children:a(`home.no_matches`)}),(0,k.jsx)(`p`,{className:`text-sm text-gray-400 mb-4`,children:`å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯`}),(L||F)&&(0,k.jsx)(y,{variant:`outline`,className:`mt-2`,onClick:()=>{R(``),I(``)},children:a(`home.clear_filters`)})]})]})]})]})]})}export{j as default};