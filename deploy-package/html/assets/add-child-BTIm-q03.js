import{t as e}from"./useQuery-3c7W5I_m.js";import{t}from"./useMutation-BpEv9aX1.js";import{t as n}from"./arrow-left-DkyxUF4z.js";import{t as r}from"./sparkles-pSeujKDs.js";import{t as i}from"./trash-2-DKMna2x9.js";import{M as a,P as o,c as s,j as c,l,n as u,s as d}from"./index-To_AjZla.js";import"./client-BnpYlOG1.js";import{t as f}from"./button-Cb3PYsQ3.js";import{t as p}from"./use-metadata-CCdbLRBt.js";import{t as m}from"./input-CdJf7bVv.js";import{t as h}from"./children-ChuGQj0-.js";var g=d(`wand-sparkles`,[[`path`,{d:`m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72`,key:`ul74o6`}],[`path`,{d:`m14 7 3 3`,key:`1r5n42`}],[`path`,{d:`M5 6v4`,key:`ilb8ba`}],[`path`,{d:`M19 14v4`,key:`blhpug`}],[`path`,{d:`M10 2v2`,key:`7u0qdc`}],[`path`,{d:`M7 8H3`,key:`zfb6yr`}],[`path`,{d:`M21 16h-4`,key:`1cnmox`}],[`path`,{d:`M11 3H9`,key:`1obp7u`}]]),_=o(),v=l();function y(){let{id:o}=a(),l=!!o,d=c(),y=s(),{t:b}=u(),{districts:x}=p(),[S,C]=(0,_.useState)({name:``,gender:`M`,current_grade:``,target_grade:``,target_districts:``,resume_text:``}),[w,T]=(0,_.useState)(``),[E,D]=(0,_.useState)(!l),[O,k]=(0,_.useState)(``),[A,j]=(0,_.useState)(``),{data:M,isLoading:N}=e({queryKey:[`child`,o],queryFn:async()=>o?(await h.list()).find(e=>e.id===Number(o)):null,enabled:l});if((0,_.useEffect)(()=>{M&&C({name:M.name,gender:M.gender,current_grade:M.current_grade,target_grade:M.target_grade||``,target_districts:M.target_districts||``,resume_text:M.resume_text||``})},[M]),l&&N)return(0,v.jsx)(`div`,{className:`min-h-screen bg-gray-50 flex flex-col items-center justify-center`,children:(0,v.jsx)(`div`,{className:`text-gray-500`,children:b(`common.loading`)||`Loading...`})});let P=t({mutationFn:h.create,onSuccess:()=>{y.invalidateQueries({queryKey:[`children`]}),d(`/app/profile`)},onError:()=>{k(b(`child.add_error`))}}),F=t({mutationFn:e=>h.update(Number(o),e),onSuccess:()=>{y.invalidateQueries({queryKey:[`children`]}),d(`/app/profile`)},onError:()=>{k(b(`child.update_error`)||`Update failed`)}}),I=t({mutationFn:()=>h.delete(Number(o)),onSuccess:()=>{y.invalidateQueries({queryKey:[`children`]}),d(`/app/profile`)}}),L=t({mutationFn:h.analyze,onSuccess:e=>{console.log(`AI Analysis Result:`,e);let t=S.gender;if(e.gender){let n=e.gender.toUpperCase();n.includes(`F`)||n.includes(`G`)||n.includes(`女`)?t=`F`:(n.includes(`M`)||n.includes(`B`)||n.includes(`男`))&&(t=`M`)}let n=e.target_districts||``,r=[];if(x&&x.length>0){let e={};x.forEach(t=>{e[t.en.toLowerCase()]=t.key,e[t.tc]=t.key,e[t.sc]=t.key,t.tc.endsWith(`区`)&&(e[t.tc.replace(`区`,``)]=t.key),t.sc.endsWith(`区`)&&(e[t.sc.replace(`区`,``)]=t.key)}),n.split(/[,，、\s]+/).filter(Boolean).forEach(t=>{let n=t.toLowerCase();if(e[n])r.push(e[n]);else{let t=Object.keys(e).find(e=>e.includes(n)||n.includes(e));t&&r.push(e[t])}})}let i=r.length>0?[...new Set(r)].join(`,`):n;C(n=>({...n,name:e.name||n.name,current_grade:e.current_grade||n.current_grade,target_districts:i||n.target_districts,gender:t,resume_text:e.resume_text||w||n.resume_text})),j(b(`child.ai_success`)),k(``)},onError:()=>{k(b(`child.ai_error`)),j(``)}});return(0,v.jsxs)(`div`,{className:`min-h-screen bg-gray-50 flex flex-col`,children:[(0,v.jsxs)(`div`,{className:`bg-white border-b px-4 h-14 flex items-center gap-3 sticky top-0 z-10`,children:[(0,v.jsx)(f,{variant:`ghost`,size:`sm`,className:`p-0 h-8 w-8`,onClick:()=>d(-1),children:(0,v.jsx)(n,{className:`h-5 w-5`})}),(0,v.jsx)(`h1`,{className:`font-semibold text-lg`,children:l?b(`child.edit_title`)||`Edit Child`:b(`child.add_title`)}),l&&(0,v.jsx)(f,{variant:`ghost`,size:`sm`,className:`ml-auto text-red-500 hover:text-red-600 hover:bg-red-50`,onClick:()=>{window.confirm(b(`child.delete_confirm`)||`Are you sure you want to delete this child profile?`)&&I.mutate()},children:(0,v.jsx)(i,{className:`h-5 w-5`})})]}),(0,v.jsxs)(`div`,{className:`p-4 flex-1 space-y-6`,children:[(0,v.jsxs)(`div`,{className:`bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg border border-indigo-100`,children:[(0,v.jsxs)(`div`,{className:`flex justify-between items-center mb-2`,children:[(0,v.jsxs)(`h3`,{className:`text-sm font-semibold text-indigo-900 flex items-center gap-2`,children:[(0,v.jsx)(r,{className:`h-4 w-4 text-indigo-600`}),b(`child.ai_title`)]}),(0,v.jsx)(f,{variant:`ghost`,size:`sm`,className:`h-6 text-xs text-indigo-700 hover:text-indigo-900 hover:bg-indigo-100`,onClick:()=>D(!E),children:b(E?`child.collapse`:`child.expand`)})]}),E&&(0,v.jsxs)(`div`,{className:`space-y-3 animate-in fade-in slide-in-from-top-2 duration-300`,children:[(0,v.jsxs)(`p`,{className:`text-xs text-indigo-700`,children:[b(`child.ai_desc`),(0,v.jsx)(`button`,{onClick:()=>{T(`我的女儿 Alice，今年读小六 (P6)，性格开朗，钢琴八级，想在九龙城找一所合适的 Band 1 女校。`)},className:`ml-2 underline font-medium hover:text-indigo-900`,children:b(`child.try_sample`)})]}),(0,v.jsx)(`textarea`,{className:`w-full min-h-[100px] rounded-md border-indigo-200 bg-white p-3 text-sm focus:border-indigo-400 focus:ring-indigo-400`,placeholder:b(`child.ai_placeholder`),value:w,onChange:e=>T(e.target.value)}),A&&(0,v.jsxs)(`div`,{className:`text-xs text-green-600 bg-green-50 px-2 py-1 rounded flex items-center gap-1`,children:[(0,v.jsx)(r,{className:`h-3 w-3`}),A]}),(0,v.jsx)(f,{size:`sm`,className:`w-full bg-indigo-600 hover:bg-indigo-700 text-white gap-2`,onClick:()=>{w.trim()&&(j(``),k(``),L.mutate(w))},disabled:L.isPending||!w.trim(),children:L.isPending?(0,v.jsx)(v.Fragment,{children:b(`child.ai_button_analyzing`)}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(g,{className:`h-3 w-3`}),b(`child.ai_button`)]})})]})]}),(0,v.jsxs)(`form`,{onSubmit:e=>{if(e.preventDefault(),!S.name||!S.current_grade){k(b(`child.validation_error`));return}l?F.mutate(S):P.mutate(S)},className:`space-y-6`,children:[(0,v.jsxs)(`div`,{className:`space-y-4 bg-white p-4 rounded-lg shadow-sm border`,children:[(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsxs)(`label`,{className:`text-sm font-medium text-gray-700`,children:[b(`child.name`),` `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsx)(m,{placeholder:b(`child.name`),value:S.name,onChange:e=>C({...S,name:e.target.value})})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsxs)(`label`,{className:`text-sm font-medium text-gray-700`,children:[b(`child.gender`),` `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`div`,{className:`flex gap-4`,children:[(0,v.jsxs)(`label`,{className:`flex items-center gap-2 border rounded-md px-4 py-2 flex-1 cursor-pointer hover:bg-gray-50 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50`,children:[(0,v.jsx)(`input`,{type:`radio`,name:`gender`,value:`M`,checked:S.gender===`M`,onChange:e=>C({...S,gender:e.target.value}),className:`accent-blue-600`}),(0,v.jsx)(`span`,{children:b(`child.boy`)})]}),(0,v.jsxs)(`label`,{className:`flex items-center gap-2 border rounded-md px-4 py-2 flex-1 cursor-pointer hover:bg-gray-50 has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50`,children:[(0,v.jsx)(`input`,{type:`radio`,name:`gender`,value:`F`,checked:S.gender===`F`,onChange:e=>C({...S,gender:e.target.value}),className:`accent-pink-600`}),(0,v.jsx)(`span`,{children:b(`child.girl`)})]})]})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsxs)(`label`,{className:`text-sm font-medium text-gray-700`,children:[b(`child.current_grade`),` `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`select`,{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,value:S.current_grade,onChange:e=>C({...S,current_grade:e.target.value}),children:[(0,v.jsx)(`option`,{value:``,disabled:!0,children:b(`child.select_grade`)}),(0,v.jsx)(`option`,{value:`K1`,children:`K1`}),(0,v.jsx)(`option`,{value:`K2`,children:`K2`}),(0,v.jsx)(`option`,{value:`K3`,children:`K3`}),(0,v.jsxs)(`option`,{value:`P1`,children:[`P1 (`,b(`child.level.primary`),` 1)`]}),(0,v.jsxs)(`option`,{value:`P2`,children:[`P2 (`,b(`child.level.primary`),` 2)`]}),(0,v.jsxs)(`option`,{value:`P3`,children:[`P3 (`,b(`child.level.primary`),` 3)`]}),(0,v.jsxs)(`option`,{value:`P4`,children:[`P4 (`,b(`child.level.primary`),` 4)`]}),(0,v.jsxs)(`option`,{value:`P5`,children:[`P5 (`,b(`child.level.primary`),` 5)`]}),(0,v.jsxs)(`option`,{value:`P6`,children:[`P6 (`,b(`child.level.primary`),` 6)`]}),(0,v.jsxs)(`option`,{value:`S1`,children:[`S1 (`,b(`child.level.secondary`),` 1)`]})]})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-gray-700`,children:b(`child.target_grade`)}),(0,v.jsxs)(`select`,{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,value:S.target_grade,onChange:e=>C({...S,target_grade:e.target.value}),children:[(0,v.jsx)(`option`,{value:``,children:b(`child.auto_infer`)}),(0,v.jsx)(`option`,{value:`K1`,children:`K1`}),(0,v.jsx)(`option`,{value:`K2`,children:`K2`}),(0,v.jsx)(`option`,{value:`K3`,children:`K3`}),(0,v.jsxs)(`option`,{value:`P1`,children:[`P1 (`,b(`child.level.primary`),` 1)`]}),(0,v.jsxs)(`option`,{value:`S1`,children:[`S1 (`,b(`child.level.secondary`),` 1)`]})]}),(0,v.jsx)(`p`,{className:`text-xs text-gray-500`,children:b(`child.auto_infer_hint`)})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-gray-700`,children:b(`child.target_districts`)}),(0,v.jsx)(m,{placeholder:b(`child.target_districts_placeholder`),value:S.target_districts,onChange:e=>C({...S,target_districts:e.target.value})})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-gray-700`,children:b(`child.resume`)}),(0,v.jsx)(`textarea`,{className:`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,placeholder:b(`child.resume_placeholder`),value:S.resume_text,onChange:e=>C({...S,resume_text:e.target.value})})]})]}),O&&(0,v.jsx)(`p`,{className:`text-sm text-red-500`,children:O}),(0,v.jsx)(f,{type:`submit`,className:`w-full`,disabled:P.isPending,children:P.isPending?b(`child.saving`):b(`child.save`)})]})]})]})}export{y as default};