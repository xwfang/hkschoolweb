import{t as e}from"./useMutation-CeBhl_8Z.js";import{t}from"./bot-CEgt1b3k.js";import{t as n}from"./sparkles-B_CxahgT.js";import{P as r,a as i,j as a,l as o,n as s,r as c,s as l}from"./index-BjApUisC.js";import{t as u}from"./client-qtjdM-KC.js";import{t as d}from"./button-7qNH0WdN.js";var f=l(`lock`,[[`rect`,{width:`18`,height:`11`,x:`3`,y:`11`,rx:`2`,ry:`2`,key:`1w4ew1`}],[`path`,{d:`M7 11V7a5 5 0 0 1 10 0v4`,key:`fwvmzm`}]]),p=l(`send`,[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]]),m=r();const h={chat:async(e,t)=>(await u.post(`/chat`,{message:e,session_id:t})).data,uploadResume:async e=>(await u.post(`/chat/resume`,{resume_text:e})).data};var g=o();function _(){let{t:r}=s(),o=a(),[l,u]=(0,m.useState)([{id:`welcome`,role:`assistant`,contentKey:`chat.welcome`}]),[_,v]=(0,m.useState)(),[y,b]=(0,m.useState)(``),x=(0,m.useRef)(null),S=[{label:r(`chat.quick_action.letter`),icon:`ðŸ“`,prompt:r(`chat.prompt.letter`)},{label:r(`chat.quick_action.interview`),icon:`ðŸŽ¤`,prompt:r(`chat.prompt.interview`)},{label:r(`chat.quick_action.resume`),icon:`ðŸ“Š`,prompt:r(`chat.prompt.resume`)}],C=e({mutationFn:e=>h.chat(e.message,e.sessionId),onSuccess:e=>{e.session_id&&v(e.session_id),u(t=>[...t,{id:new Date().getTime().toString(),role:`assistant`,content:e.message,reasoning:e.reasoning,schools:e.schools}])},onError:e=>{let t=r(`chat.error`),n=!1;e?.response?.status===429&&(t=r(`subscription.limit_reached_desc`),n=!0),u(e=>[...e,{id:new Date().getTime().toString(),role:`assistant`,content:t,isLimitError:n}])}}),w=()=>{x.current?.scrollIntoView({behavior:`smooth`})};(0,m.useEffect)(()=>{w()},[l]);let T=(e,t)=>{e?.preventDefault();let n=t||y;if(!n.trim()||C.isPending)return;let r={id:new Date().getTime().toString(),role:`user`,content:n};u(e=>[...e,r]),b(``),C.mutate({message:r.content||``,sessionId:_})};return(0,g.jsxs)(`div`,{className:`flex flex-col h-full bg-gray-50`,children:[(0,g.jsxs)(`div`,{className:`bg-white border-b px-4 h-14 flex items-center gap-2 sticky top-0 z-10 shadow-sm`,children:[(0,g.jsx)(`div`,{className:`bg-indigo-100 p-1.5 rounded-full`,children:(0,g.jsx)(t,{className:`h-5 w-5 text-indigo-600`})}),(0,g.jsx)(`h1`,{className:`font-semibold text-lg`,children:r(`chat.title`)}),(0,g.jsx)(`div`,{className:`ml-auto`,children:(0,g.jsx)(n,{className:`h-4 w-4 text-yellow-500 animate-pulse`})})]}),(0,g.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4 space-y-4`,children:[l.map(e=>(0,g.jsxs)(`div`,{className:c(`flex w-full gap-3`,e.role===`user`?`justify-end`:`justify-start`),children:[e.role===`assistant`&&(0,g.jsx)(`div`,{className:`flex-shrink-0 h-8 w-8 bg-indigo-100 rounded-full flex items-center justify-center mt-1`,children:(0,g.jsx)(t,{className:`h-5 w-5 text-indigo-600`})}),(0,g.jsxs)(`div`,{className:c(`max-w-[80%] rounded-2xl px-4 py-2.5 text-sm shadow-sm whitespace-pre-wrap`,e.role===`user`?`bg-indigo-600 text-white rounded-tr-none`:`bg-white text-gray-800 border rounded-tl-none`),children:[e.reasoning&&(0,g.jsxs)(`div`,{className:`mb-2 p-2 bg-gray-100 rounded text-xs text-gray-500 italic border-l-2 border-indigo-300`,children:[(0,g.jsx)(`span`,{className:`font-semibold not-italic block mb-1`,children:`Thinking Process:`}),e.reasoning]}),e.content||(e.contentKey?r(e.contentKey):``),e.isLimitError&&(0,g.jsxs)(`div`,{className:`mt-4 p-4 bg-orange-50 rounded-lg border border-orange-200`,children:[(0,g.jsxs)(`div`,{className:`flex items-center gap-2 text-orange-800 font-medium mb-2`,children:[(0,g.jsx)(f,{className:`w-4 h-4`}),r(`subscription.limit_reached_title`)]}),(0,g.jsx)(`p`,{className:`text-sm text-orange-700 mb-3`,children:r(`subscription.limit_reached_desc`)}),(0,g.jsx)(d,{size:`sm`,className:`w-full bg-orange-600 hover:bg-orange-700 text-white`,onClick:()=>o(`/app/subscription`),children:r(`subscription.upgrade_now`)})]}),e.schools&&e.schools.length>0&&(0,g.jsxs)(`div`,{className:`mt-3 space-y-2`,children:[(0,g.jsx)(`div`,{className:`text-xs font-medium text-gray-500 uppercase tracking-wider`,children:`Found Schools`}),e.schools.map(e=>(0,g.jsxs)(`div`,{className:`bg-gray-50 p-2 rounded border text-left`,children:[(0,g.jsx)(`div`,{className:`font-medium text-indigo-700`,children:e.name_cn||e.name_en}),(0,g.jsxs)(`div`,{className:`text-xs text-gray-500 flex gap-2 mt-1`,children:[e.banding&&(0,g.jsx)(`span`,{className:`bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded`,children:e.banding}),e.district&&(0,g.jsx)(`span`,{className:`bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded`,children:e.district})]})]},e.id))]})]}),e.role===`user`&&(0,g.jsx)(`div`,{className:`flex-shrink-0 h-8 w-8 bg-gray-200 rounded-full flex items-center justify-center mt-1`,children:(0,g.jsx)(i,{className:`h-5 w-5 text-gray-500`})})]},e.id)),C.isPending&&(0,g.jsxs)(`div`,{className:`flex w-full gap-3 justify-start`,children:[(0,g.jsx)(`div`,{className:`flex-shrink-0 h-8 w-8 bg-indigo-100 rounded-full flex items-center justify-center mt-1`,children:(0,g.jsx)(t,{className:`h-5 w-5 text-indigo-600`})}),(0,g.jsxs)(`div`,{className:`bg-white border rounded-2xl rounded-tl-none px-4 py-3 shadow-sm flex items-center gap-2`,children:[(0,g.jsx)(`span`,{className:`text-sm text-gray-500`,children:r(`chat.thinking`)}),(0,g.jsxs)(`div`,{className:`flex gap-1`,children:[(0,g.jsx)(`div`,{className:`w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`0ms`}}),(0,g.jsx)(`div`,{className:`w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`150ms`}}),(0,g.jsx)(`div`,{className:`w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`300ms`}})]})]})]}),(0,g.jsx)(`div`,{ref:x})]}),l.length<=1&&(0,g.jsx)(`div`,{className:`px-4 pb-2 grid grid-cols-3 gap-2`,children:S.map(e=>(0,g.jsxs)(`button`,{onClick:()=>T(void 0,e.prompt),className:`flex flex-col items-center justify-center gap-1.5 p-3 bg-white border rounded-xl hover:bg-gray-50 transition-colors shadow-sm`,children:[(0,g.jsx)(`span`,{className:`text-xl`,children:e.icon}),(0,g.jsx)(`span`,{className:`text-xs font-medium text-gray-700`,children:e.label})]},e.label))}),(0,g.jsx)(`div`,{className:`bg-white border-t p-3 safe-area-pb`,children:(0,g.jsxs)(`form`,{onSubmit:e=>T(e),className:`flex gap-2 items-end`,children:[(0,g.jsx)(`textarea`,{value:y,onChange:e=>b(e.target.value),onKeyDown:e=>{e.key===`Enter`&&!e.shiftKey&&(e.preventDefault(),T(void 0))},placeholder:r(`chat.input_placeholder`),className:c(`flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,`flex-1 bg-gray-50 focus:bg-white resize-none min-h-[80px]`),disabled:C.isPending}),(0,g.jsx)(d,{type:`submit`,size:`icon`,className:`shrink-0 bg-indigo-600 hover:bg-indigo-700 h-10 w-10 mb-0.5`,disabled:!y.trim()||C.isPending,children:(0,g.jsx)(p,{className:`h-4 w-4`})})]})})]})}export{_ as default};