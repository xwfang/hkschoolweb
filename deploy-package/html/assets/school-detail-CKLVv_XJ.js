import{t as e}from"./useQuery-BjdESFyc.js";import{t}from"./useMutation-DOFzbWlu.js";import{t as n}from"./arrow-left-W1Zw3FJg.js";import{t as r}from"./external-link-Ai0Od4fG.js";import{n as i,r as a,t as o}from"./schools-BTIwybL2.js";import{t as s}from"./globe-GYYLK-ey.js";import{M as c,c as l,j as u,l as d,n as f}from"./index-CtGP5V70.js";import"./middleware-B8Tclb96.js";import{t as p}from"./auth-BHH58HuU.js";import"./client-DDqdnC_J.js";import{t as m}from"./button-D9YJsIxB.js";import{t as h}from"./use-metadata-BuU4uObT.js";import{t as g}from"./applications-BZ0khzrK.js";var _=d();function v(){let{t:d,i18n:v}=f(),{getDistrictLabel:y,getGenderLabel:b,getCategoryLabel:x,getReligionLabel:S,getTagLabel:C}=h(),{id:w}=c(),T=u(),{currentChildId:E}=p(),D=l(),{data:O,isLoading:k}=e({queryKey:[`school`,w],queryFn:()=>o.get(w),enabled:!!w}),{data:A}=e({queryKey:[`applications`,E],queryFn:()=>E?g.list(E):null,enabled:!!E}),j=A?.find(e=>e.school_id===Number(w)),M=v.language===`en`,N=M?O?.name_en||O?.name_cn:O?.name_cn||O?.name_en,P=M?O?.name_cn:O?.name_en,F=t({mutationFn:g.create,onSuccess:()=>{D.invalidateQueries({queryKey:[`applications`]})}}),I=t({mutationFn:e=>g.update(e.id,{status:e.status}),onSuccess:()=>{D.invalidateQueries({queryKey:[`applications`]})}}),L=()=>{if(!E){T(`/app/profile`);return}F.mutate({child_id:E,school_id:Number(w),status:`interested`})},R=()=>{window.history.state&&window.history.state.idx>0?T(-1):T(`/app/home`,{replace:!0})};return k?(0,_.jsx)(`div`,{className:`p-4 text-center`,children:d(`common.loading`)}):O?(0,_.jsxs)(`div`,{className:`min-h-screen bg-white pb-32`,children:[(0,_.jsxs)(`div`,{className:`bg-white px-3 h-14 flex items-center gap-3 sticky top-0 z-10 border-b`,children:[(0,_.jsx)(m,{variant:`ghost`,size:`sm`,className:`p-0 h-8 w-8`,onClick:R,children:(0,_.jsx)(n,{className:`h-5 w-5`})}),(0,_.jsx)(`h1`,{className:`font-semibold text-lg truncate flex-1`,children:N})]}),(0,_.jsxs)(`div`,{className:`p-3 space-y-6`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`h2`,{className:`text-xl font-bold`,children:N}),(0,_.jsx)(`p`,{className:`text-gray-500 text-sm`,children:P})]}),(0,_.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[O.banding&&(0,_.jsx)(`span`,{className:`bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm`,children:O.banding}),(0,_.jsx)(`span`,{className:`bg-gray-100 px-3 py-1 rounded-full text-sm`,children:y(O.district)}),(0,_.jsx)(`span`,{className:`bg-gray-100 px-3 py-1 rounded-full text-sm`,children:b(O.gender)}),(0,_.jsx)(`span`,{className:`bg-gray-100 px-3 py-1 rounded-full text-sm`,children:x(O.category)}),O.religion&&(0,_.jsx)(`span`,{className:`bg-gray-100 px-3 py-1 rounded-full text-sm`,children:S(O.religion)}),O.school_net&&(0,_.jsxs)(`span`,{className:`bg-gray-100 px-3 py-1 rounded-full text-sm`,children:[d(`school.net`),`: `,O.school_net]})]}),(0,_.jsxs)(`div`,{className:`flex flex-col gap-3`,children:[O.popularity!==void 0&&(0,_.jsxs)(`div`,{className:`flex items-center gap-1 text-orange-600 font-medium text-sm`,children:[(0,_.jsx)(a,{className:`h-4 w-4 fill-orange-100`}),O.popularity,` `,d(`common.popularity`)||`çƒ­åº¦`]}),O.tags&&(0,_.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:O.tags.split(`,`).map(e=>(0,_.jsxs)(`span`,{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-50 text-indigo-700 border border-indigo-100`,children:[(0,_.jsx)(i,{className:`w-3 h-3 mr-1`}),C(e.trim())]},e))})]}),(0,_.jsxs)(`div`,{className:`space-y-4 pt-4 border-t`,children:[(0,_.jsx)(`h3`,{className:`font-semibold`,children:d(`school.info_title`)}),(0,_.jsxs)(`div`,{className:`grid grid-cols-2 gap-4 text-sm`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`p`,{className:`text-gray-500`,children:d(`school.type`)}),(0,_.jsx)(`p`,{children:x(O.category)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`p`,{className:`text-gray-500`,children:d(`school.district`)}),(0,_.jsx)(`p`,{children:y(O.district)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`p`,{className:`text-gray-500`,children:d(`school.moi`)}),(0,_.jsx)(`p`,{children:O.moi||d(`school.no_info`)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`p`,{className:`text-gray-500`,children:d(`school.religion`)}),(0,_.jsx)(`p`,{children:O.religion?S(O.religion):d(`school.none`)})]})]}),(0,_.jsxs)(`div`,{className:`bg-yellow-50 p-3 rounded-md border border-yellow-100`,children:[(0,_.jsxs)(`h4`,{className:`font-medium text-yellow-800 mb-2 text-sm`,children:[`ðŸ“… `,d(`school.admission_info`)]}),O.website_admission?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(`p`,{className:`text-xs text-yellow-700 mb-3`,children:d(`school.admission_info_found_desc`,`è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹æœ€æ–°æ’ç­/æ‹›ç”Ÿèµ„è®¯ã€‚`)}),(0,_.jsxs)(m,{size:`sm`,className:`w-full bg-yellow-600 hover:bg-yellow-700 text-white border-none shadow-sm`,onClick:()=>window.open(O.website_admission,`_blank`),children:[(0,_.jsx)(r,{className:`h-4 w-4 mr-2`}),d(`school.view_admission_info`,`æŸ¥çœ‹æ‹›ç”Ÿè¯¦æƒ…`)]})]}):(0,_.jsx)(`p`,{className:`text-xs text-yellow-700`,children:d(`school.admission_info_desc`)})]}),(0,_.jsxs)(`div`,{className:`space-y-3`,children:[O.website_home&&(0,_.jsxs)(`a`,{href:O.website_home,target:`_blank`,rel:`noreferrer`,className:`flex items-center gap-2 text-blue-600 hover:underline`,children:[(0,_.jsx)(s,{className:`h-4 w-4`}),d(`school.website`)]}),O.website_admission&&(0,_.jsxs)(`a`,{href:O.website_admission,target:`_blank`,rel:`noreferrer`,className:`flex items-center gap-2 text-blue-600 hover:underline`,children:[(0,_.jsx)(r,{className:`h-4 w-4`}),d(`school.admission_page`)]})]})]}),(0,_.jsx)(`div`,{className:`fixed bottom-0 left-0 right-0 p-4 bg-white border-t safe-area-pb`,children:j?(0,_.jsxs)(`div`,{className:`space-y-2`,children:[(0,_.jsx)(`label`,{className:`text-xs text-gray-500`,children:d(`school.current_status`)}),(0,_.jsxs)(`select`,{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,value:j.status,onChange:e=>I.mutate({id:j.id,status:e.target.value}),disabled:I.isPending,children:[(0,_.jsx)(`option`,{value:`interested`,children:d(`status.interested`)}),(0,_.jsx)(`option`,{value:`applied`,children:d(`status.applied`)}),(0,_.jsx)(`option`,{value:`interview`,children:d(`status.interview`)}),(0,_.jsx)(`option`,{value:`offer`,children:d(`status.offer`)}),(0,_.jsx)(`option`,{value:`rejected`,children:d(`status.rejected`)})]})]}):(0,_.jsx)(m,{className:`w-full`,size:`lg`,disabled:F.isPending,onClick:L,children:d(`school.add_to_tracking`)})})]})]}):(0,_.jsxs)(`div`,{className:`p-4 text-center mt-10`,children:[(0,_.jsxs)(`div`,{className:`bg-red-50 text-red-800 p-4 rounded-lg mb-4`,children:[(0,_.jsx)(`p`,{className:`font-bold`,children:d(`school.not_found`)}),(0,_.jsx)(`p`,{className:`text-sm mt-1`,children:d(`school.not_found_desc`,{id:w})})]}),(0,_.jsx)(m,{variant:`outline`,onClick:R,children:d(`school.back`)})]})}export{v as default};