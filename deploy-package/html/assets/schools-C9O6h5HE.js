import{t as e}from"./useQuery-yN23VgZp.js";import{t}from"./useMutation-CJ7nF_qk.js";import{t as n}from"./bot-DuC-UCVU.js";import{t as r}from"./external-link-DQVchIeb.js";import{t as i}from"./globe-D-iVXJSv.js";import{t as a}from"./refresh-cw-9lHHH24g.js";import{t as o}from"./trash-2-B_kA71kL.js";import{P as s,l as c,s as l}from"./index-DUjOKN6m.js";import{t as u}from"./card-pF5A2EPj.js";import{t as d}from"./client-BM3oM8Q4.js";import{t as f}from"./button-BRHYo3UI.js";import{t as p}from"./use-metadata-O6xCb8AI.js";var m=l(`circle-alert`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`line`,{x1:`12`,x2:`12`,y1:`8`,y2:`12`,key:`1pkeuh`}],[`line`,{x1:`12`,x2:`12.01`,y1:`16`,y2:`16`,key:`4dfq90`}]]),h=l(`square-pen`,[[`path`,{d:`M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`,key:`1m0v6g`}],[`path`,{d:`M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z`,key:`ohrbg2`}]]);const g={getSchools:async(e=1,t=50)=>(await d.get(`/schools`,{params:{page:e,limit:t,sort:`id`}})).data,createSchool:async e=>(await d.post(`/schools`,e)).data,updateSchool:async(e,t)=>(await d.put(`/schools/${e}`,t)).data,deleteSchool:async e=>{await d.delete(`/schools/${e}`)},crawlSchool:async e=>(await d.post(`/crawl`,null,{params:{school_id:e}})).data,crawlDiscover:async()=>(await d.post(`/crawl`,null,{params:{action:`discover`}})).data,crawlBatch:async(e,t)=>(await d.post(`/crawl`,null,{params:{district:e,banding:t}})).data};var _=s(),v=c();function y(){let[s,c]=(0,_.useState)(null),[l,d]=(0,_.useState)(``),[y,b]=(0,_.useState)(``),{districts:x,getDistrictLabel:S}=p(),{data:C,isLoading:w,refetch:T}=e({queryKey:[`admin-schools`],queryFn:()=>g.getSchools(1,100)}),E=t({mutationFn:g.crawlSchool,onMutate:e=>c(e),onSettled:()=>c(null),onSuccess:e=>{alert(`Crawl Success!\n${JSON.stringify(e.data,null,2)}`),T()},onError:e=>{alert(`Crawl Failed: `+e)}}),D=t({mutationFn:g.crawlDiscover,onSuccess:e=>{alert(`Discovery Started!\n${e.message}`),T()},onError:e=>{alert(`Discovery Failed: `+e)}}),O=t({mutationFn:({district:e,banding:t})=>g.crawlBatch(e,t),onSuccess:e=>{alert(`Batch Crawl Started!\n${e.message}`),T()},onError:e=>{alert(`Batch Crawl Failed: `+e)}}),k=t({mutationFn:g.deleteSchool,onSuccess:()=>{T()},onError:e=>{alert(`Delete Failed: `+e)}}),A=e=>{confirm(`Are you sure you want to delete this school?`)&&k.mutate(e)};return w?(0,v.jsx)(`div`,{children:`Loading schools...`}):(0,v.jsxs)(`div`,{className:`space-y-6`,children:[(0,v.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,v.jsx)(`h2`,{className:`text-2xl font-bold text-slate-800`,children:`Schools Management`}),(0,v.jsxs)(`div`,{className:`flex gap-2`,children:[(0,v.jsxs)(f,{onClick:()=>D.mutate(),variant:`default`,size:`sm`,disabled:D.isPending,children:[(0,v.jsx)(i,{className:`w-4 h-4 mr-2`}),D.isPending?`Discovering...`:`Discover New Schools`]}),(0,v.jsxs)(f,{onClick:()=>T(),variant:`outline`,size:`sm`,children:[(0,v.jsx)(a,{className:`w-4 h-4 mr-2`}),` Refresh List`]})]})]}),(0,v.jsxs)(u,{className:`p-6 bg-white shadow-sm border border-slate-200`,children:[(0,v.jsxs)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2`,children:[(0,v.jsx)(n,{className:`w-5 h-5 text-indigo-600`}),`Batch Crawler`]}),(0,v.jsxs)(`div`,{className:`flex flex-wrap gap-4 items-end`,children:[(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-slate-700 block`,children:`District`}),(0,v.jsxs)(`select`,{className:`flex h-10 w-[200px] items-center justify-between rounded-md border border-slate-300 bg-transparent px-3 py-2 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-400 disabled:cursor-not-allowed disabled:opacity-50`,value:l,onChange:e=>d(e.target.value),children:[(0,v.jsx)(`option`,{value:``,children:`Select District`}),x.map(e=>(0,v.jsx)(`option`,{value:e.key,children:S(e.key)},e.key))]})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-slate-700 block`,children:`Banding`}),(0,v.jsxs)(`select`,{className:`flex h-10 w-[200px] items-center justify-between rounded-md border border-slate-300 bg-transparent px-3 py-2 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-400 disabled:cursor-not-allowed disabled:opacity-50`,value:y,onChange:e=>b(e.target.value),children:[(0,v.jsx)(`option`,{value:``,children:`Select Banding`}),(0,v.jsx)(`option`,{value:`Band 1`,children:`Band 1`}),(0,v.jsx)(`option`,{value:`Band 2`,children:`Band 2`}),(0,v.jsx)(`option`,{value:`Band 3`,children:`Band 3`})]})]}),(0,v.jsx)(f,{onClick:()=>O.mutate({district:l,banding:y}),disabled:!l||O.isPending,className:`bg-indigo-600 hover:bg-indigo-700`,children:O.isPending?`Crawling...`:`Start Batch Crawl`})]}),(0,v.jsx)(`p`,{className:`text-sm text-slate-500 mt-2`,children:`* This will trigger a background job to crawl admission details for all schools in the selected district.`})]}),(0,v.jsx)(u,{className:`overflow-hidden bg-white shadow-sm border border-slate-200`,children:(0,v.jsx)(`div`,{className:`overflow-x-auto`,children:(0,v.jsxs)(`table`,{className:`w-full text-left text-sm`,children:[(0,v.jsx)(`thead`,{className:`bg-slate-50 border-b border-slate-200`,children:(0,v.jsxs)(`tr`,{children:[(0,v.jsx)(`th`,{className:`px-6 py-4 font-semibold text-slate-700`,children:`ID`}),(0,v.jsx)(`th`,{className:`px-6 py-4 font-semibold text-slate-700`,children:`School Name`}),(0,v.jsx)(`th`,{className:`px-6 py-4 font-semibold text-slate-700`,children:`Admission URL`}),(0,v.jsx)(`th`,{className:`px-6 py-4 font-semibold text-slate-700`,children:`Admission Info (AI Scraped)`}),(0,v.jsx)(`th`,{className:`px-6 py-4 font-semibold text-slate-700`,children:`Actions`})]})}),(0,v.jsx)(`tbody`,{className:`divide-y divide-slate-100`,children:C?.map(e=>(0,v.jsxs)(`tr`,{className:`hover:bg-slate-50 transition-colors`,children:[(0,v.jsxs)(`td`,{className:`px-6 py-4 text-slate-500`,children:[`#`,e.id]}),(0,v.jsxs)(`td`,{className:`px-6 py-4 font-medium text-slate-900`,children:[(0,v.jsx)(`div`,{children:e.name_en}),(0,v.jsx)(`div`,{className:`text-xs text-slate-500`,children:e.name_cn})]}),(0,v.jsx)(`td`,{className:`px-6 py-4`,children:e.website_admission?(0,v.jsxs)(`a`,{href:e.website_admission,target:`_blank`,rel:`noreferrer`,className:`flex items-center text-blue-600 hover:underline`,children:[`Link `,(0,v.jsx)(r,{className:`w-3 h-3 ml-1`})]}):(0,v.jsx)(`span`,{className:`text-slate-400 italic`,children:`Not set`})}),(0,v.jsx)(`td`,{className:`px-6 py-4`,children:(0,v.jsx)(`div`,{className:`space-y-1`,children:(0,v.jsxs)(`div`,{className:`flex items-center text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded w-fit`,children:[(0,v.jsx)(m,{className:`w-3 h-3 mr-1`}),` Not scraped yet`]})})}),(0,v.jsx)(`td`,{className:`px-6 py-4`,children:(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsxs)(f,{variant:`ghost`,size:`sm`,disabled:!e.website_admission||E.isPending,onClick:()=>E.mutate(e.id),className:s===e.id?`animate-pulse bg-blue-50 text-blue-600`:``,children:[s===e.id?(0,v.jsx)(a,{className:`w-4 h-4 mr-1 animate-spin`}):(0,v.jsx)(a,{className:`w-4 h-4 mr-1`}),s===e.id?`Crawling...`:`Crawl`]}),(0,v.jsx)(f,{variant:`ghost`,size:`sm`,children:(0,v.jsx)(h,{className:`w-4 h-4 text-slate-500`})}),(0,v.jsx)(f,{variant:`ghost`,size:`sm`,className:`text-red-500 hover:text-red-700 hover:bg-red-50`,onClick:()=>A(e.id),children:(0,v.jsx)(o,{className:`w-4 h-4`})})]})})]},e.id))})]})})})]})}export{y as default};