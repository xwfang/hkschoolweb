import{t as e}from"./useQuery-a7lXwHXE.js";import{t}from"./useMutation-Dh1EHmf6.js";import{P as n,a as r,c as i,j as a,l as o,n as s,o as c,s as l}from"./index-D27tiue1.js";import"./middleware-CELj4Ujy.js";import{t as u}from"./auth-Bw72YQ6I.js";import{a as d,n as f,t as p}from"./card-CppBnQzj.js";import"./client-CG0YDuCE.js";import{t as m}from"./button-Bw0sUBGx.js";import{t as h}from"./children-DowQlCAe.js";import{t as g}from"./applications-CI0em47j.js";var _=l(`file-text`,[[`path`,{d:`M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z`,key:`1oefj6`}],[`path`,{d:`M14 2v5a1 1 0 0 0 1 1h5`,key:`wfsgrz`}],[`path`,{d:`M10 9H8`,key:`b1mrlr`}],[`path`,{d:`M16 13H8`,key:`t4e002`}],[`path`,{d:`M16 17H8`,key:`z1uh3a`}]]),v=l(`save`,[[`path`,{d:`M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z`,key:`1c8476`}],[`path`,{d:`M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7`,key:`1ydtos`}],[`path`,{d:`M7 3v4a1 1 0 0 0 1 1h7`,key:`t51u73`}]]),y=l(`x`,[[`path`,{d:`M18 6 6 18`,key:`1bl5f8`}],[`path`,{d:`m6 6 12 12`,key:`d8bk6v`}]]),b=n(),x=o();function S({app:e,statusMap:n,childName:o}){let{t:c,i18n:l}=s(),u=a(),h=i(),[S,C]=(0,b.useState)(!1),[w,T]=(0,b.useState)(e.notes||``),E=t({mutationFn:t=>g.update(e.id,t),onSuccess:()=>{h.invalidateQueries({queryKey:[`applications`]}),C(!1)}}),D=e=>{e.stopPropagation(),E.mutate({notes:w})},O=t=>{t.stopPropagation(),T(e.notes||``),C(!1)},k=l.language===`en`,A=k?e.school?.name_en||e.school?.name_cn:e.school?.name_cn||e.school?.name_en,j=k?e.school?.name_cn:e.school?.name_en;return(0,x.jsxs)(p,{className:`cursor-pointer active:scale-[0.98] transition-all duration-200 hover:shadow-md hover:-translate-y-0.5 border-gray-100`,onClick:()=>u(`/app/school/${e.school_id}`),children:[(0,x.jsx)(d,{className:`p-3 pb-2`,children:(0,x.jsxs)(`div`,{className:`flex justify-between items-start gap-2`,children:[(0,x.jsxs)(`div`,{className:`flex-1 min-w-0 pr-2 text-left`,children:[(0,x.jsx)(`h3`,{className:`font-semibold text-base leading-tight tracking-tight text-gray-900 line-clamp-1 text-left`,children:A}),(0,x.jsx)(`p`,{className:`text-xs text-gray-500 mt-0.5 line-clamp-1 text-left`,children:j})]}),(0,x.jsxs)(`div`,{onClick:e=>e.stopPropagation(),className:`shrink-0 flex items-center gap-2`,children:[o&&(0,x.jsxs)(`div`,{className:`flex items-center gap-1 bg-indigo-50 text-indigo-700 px-1.5 py-0.5 rounded-full`,children:[(0,x.jsx)(r,{className:`h-3 w-3`}),(0,x.jsx)(`span`,{className:`text-[10px] font-medium max-w-[4rem] truncate`,children:o})]}),(0,x.jsx)(`select`,{className:`text-xs px-2 py-1 rounded-full font-normal border-0 ${n[e.status]?.color||`bg-gray-100`} cursor-pointer focus:ring-0 appearance-none pr-6 relative`,value:e.status,onChange:e=>E.mutate({status:e.target.value}),disabled:E.isPending,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:`right 0.2rem center`,backgroundRepeat:`no-repeat`,backgroundSize:`1.2em 1.2em`,paddingRight:`1.5rem`},children:Object.entries(n).map(([e,t])=>(0,x.jsx)(`option`,{value:e,className:`text-black bg-white`,children:t.label},e))})]})]})}),(0,x.jsxs)(f,{className:`p-3 pt-0 pb-3`,children:[S?(0,x.jsxs)(`div`,{className:`mt-2 space-y-2`,onClick:e=>e.stopPropagation(),children:[(0,x.jsx)(`textarea`,{value:w,onChange:e=>T(e.target.value),placeholder:`Add notes...`,className:`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`}),(0,x.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,x.jsxs)(m,{size:`sm`,variant:`ghost`,onClick:O,className:`h-7 px-2`,children:[(0,x.jsx)(y,{className:`h-3.5 w-3.5 mr-1`}),` `,c(`common.cancel`)||`取消`]}),(0,x.jsxs)(m,{size:`sm`,onClick:D,disabled:E.isPending,className:`h-7 px-2`,children:[(0,x.jsx)(v,{className:`h-3.5 w-3.5 mr-1`}),` `,c(`common.save`)||`保存`]})]})]}):(0,x.jsxs)(`div`,{className:`mt-1 flex items-start gap-2 group`,children:[(0,x.jsx)(`div`,{className:`p-1.5 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors shrink-0`,onClick:e=>{e.stopPropagation(),C(!0)},children:(0,x.jsx)(_,{className:`h-4 w-4`})}),e.notes?(0,x.jsx)(`p`,{className:`text-sm text-gray-600 pt-1 line-clamp-2`,children:e.notes}):(0,x.jsx)(`p`,{className:`text-sm text-gray-400 pt-1 italic cursor-pointer hover:text-gray-500`,onClick:e=>{e.stopPropagation(),C(!0)},children:c(`common.add_notes`)||`添加备注...`})]}),(0,x.jsxs)(`div`,{className:`mt-3 text-[10px] text-gray-400 text-right`,children:[c(`common.last_updated`)||`最后更新`,`: `,new Date(e.updated_at).toLocaleDateString()]})]})]})}function C(){let{currentChildId:t}=u(),n=i(),{t:r}=s(),{data:a}=e({queryKey:[`children`],queryFn:h.list}),o={interested:{label:r(`status.interested`),color:`bg-gray-100 text-gray-800`},applied:{label:r(`status.applied`),color:`bg-yellow-100 text-yellow-800`},interview:{label:r(`status.interview`),color:`bg-blue-100 text-blue-800`},offer:{label:r(`status.offer`),color:`bg-green-100 text-green-800`},rejected:{label:r(`status.rejected`),color:`bg-red-100 text-red-800`}},{data:l,isLoading:d,isError:f}=e({queryKey:[`applications`,t],queryFn:()=>g.list(t||void 0)});return f?(0,x.jsxs)(`div`,{className:`p-4 text-center mt-10`,children:[(0,x.jsx)(`p`,{className:`text-red-500 mb-4`,children:r(`common.error`)}),(0,x.jsx)(`button`,{onClick:()=>n.invalidateQueries({queryKey:[`applications`]}),className:`text-primary underline`,children:r(`common.retry`)||`Retry`})]}):(0,x.jsxs)(`div`,{className:`p-2 space-y-3`,children:[(0,x.jsx)(`h1`,{className:`text-xl font-bold px-1`,children:r(`nav.tracking`)}),d?(0,x.jsx)(`div`,{className:`text-center text-sm text-gray-500`,children:r(`common.loading`)}):l?.length===0?(0,x.jsxs)(`div`,{className:`text-center text-gray-500 py-16 bg-gradient-to-b from-gray-50 to-white rounded-xl border-2 border-dashed border-gray-200`,children:[(0,x.jsx)(`div`,{className:`bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4`,children:(0,x.jsx)(c,{className:`h-8 w-8 text-indigo-500`})}),(0,x.jsx)(`p`,{className:`text-base font-medium text-gray-700 mb-1`,children:r(`tracking.no_schools`)||`暂无关注的学校`}),(0,x.jsx)(`p`,{className:`text-sm text-gray-400`,children:`去首页发现更多学校吧`})]}):(0,x.jsx)(`div`,{className:`space-y-3`,children:l?.map(e=>(0,x.jsx)(S,{app:e,statusMap:o,childName:t?void 0:a?.find(t=>t.id===e.child_id)?.name},e.id))})]})}export{C as default};