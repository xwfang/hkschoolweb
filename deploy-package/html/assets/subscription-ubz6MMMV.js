import{t as e}from"./arrow-left-nk6jDil3.js";import{t}from"./check-Bbn6Ey9p.js";import{P as n,j as r,l as i,n as a,s as o}from"./index-D27tiue1.js";import{a as s,n as c,o as l,r as u,t as d}from"./card-CppBnQzj.js";import{t as f}from"./client-CG0YDuCE.js";import{t as p}from"./button-Bw0sUBGx.js";import{t as m}from"./input-Bk2loKwT.js";var h=o(`qr-code`,[[`rect`,{width:`5`,height:`5`,x:`3`,y:`3`,rx:`1`,key:`1tu5fj`}],[`rect`,{width:`5`,height:`5`,x:`16`,y:`3`,rx:`1`,key:`1v8r4q`}],[`rect`,{width:`5`,height:`5`,x:`3`,y:`16`,rx:`1`,key:`1x03jg`}],[`path`,{d:`M21 16h-3a2 2 0 0 0-2 2v3`,key:`177gqh`}],[`path`,{d:`M21 21v.01`,key:`ents32`}],[`path`,{d:`M12 7v3a2 2 0 0 1-2 2H7`,key:`8crl2c`}],[`path`,{d:`M3 12h.01`,key:`nlz23k`}],[`path`,{d:`M12 3h.01`,key:`n36tog`}],[`path`,{d:`M12 16v.01`,key:`133mhm`}],[`path`,{d:`M16 12h1`,key:`1slzba`}],[`path`,{d:`M21 12v.01`,key:`1lwtk9`}],[`path`,{d:`M12 21v-1`,key:`1880an`}]]),g=n();const _={getPlans:async()=>(await f.get(`/plans`)).data,createOrder:async e=>(await f.post(`/orders`,e)).data,listOrders:async()=>(await f.get(`/orders`)).data,reviewOrder:async(e,t)=>(await f.post(`/orders/${e}/review`,{action:t})).data};var v=i();function y(){let n=r(),{t:i}=a(),[o,f]=(0,g.useState)([]),[y,b]=(0,g.useState)(null),[x,S]=(0,g.useState)(``),[C,w]=(0,g.useState)(!1),[T,E]=(0,g.useState)(!1),[D,O]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{(async()=>{w(!0);try{let e=await _.getPlans();f(e),e.length>0&&b(e[0].id)}catch(e){console.error(`Failed to fetch plans`,e)}finally{w(!1)}})()},[]),D?(0,v.jsx)(`div`,{className:`min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4`,children:(0,v.jsxs)(d,{className:`w-full max-w-md`,children:[(0,v.jsxs)(s,{className:`text-center`,children:[(0,v.jsx)(`div`,{className:`mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4`,children:(0,v.jsx)(t,{className:`w-8 h-8 text-green-600`})}),(0,v.jsx)(l,{children:i(`subscription.success`)}),(0,v.jsx)(u,{className:`mt-2`,children:i(`subscription.success_desc`)})]}),(0,v.jsx)(c,{className:`flex justify-center`,children:(0,v.jsx)(p,{onClick:()=>n(`/app/chat`),children:i(`common.confirm`)})})]})}):(0,v.jsxs)(`div`,{className:`min-h-screen bg-gray-50 flex flex-col`,children:[(0,v.jsxs)(`div`,{className:`sticky top-0 bg-white z-10 px-4 py-3 flex items-center gap-3 border-b shadow-sm`,children:[(0,v.jsx)(`button`,{onClick:()=>n(-1),className:`p-1 rounded-full hover:bg-gray-100`,children:(0,v.jsx)(e,{className:`w-6 h-6 text-gray-700`})}),(0,v.jsx)(`h1`,{className:`text-lg font-bold text-gray-900`,children:i(`subscription.title`)})]}),(0,v.jsxs)(`div`,{className:`flex-1 p-4 max-w-lg mx-auto w-full space-y-6`,children:[(0,v.jsx)(`div`,{className:`text-center space-y-2`,children:(0,v.jsx)(`h2`,{className:`text-2xl font-bold text-gray-900`,children:i(`subscription.desc`)})}),(0,v.jsxs)(`div`,{className:`space-y-4`,children:[(0,v.jsx)(`h3`,{className:`text-sm font-medium text-gray-500 uppercase tracking-wider`,children:i(`subscription.select_plan`)}),C?(0,v.jsx)(`div`,{className:`text-center py-8 text-gray-500`,children:i(`common.loading`)}):(0,v.jsx)(`div`,{className:`grid gap-4`,children:o.map(e=>(0,v.jsxs)(`div`,{onClick:()=>b(e.id),className:`
                    relative p-4 rounded-xl border-2 cursor-pointer transition-all
                    ${y===e.id?`border-indigo-600 bg-indigo-50/50 shadow-sm`:`border-gray-200 bg-white hover:border-gray-300`}
                  `,children:[(0,v.jsxs)(`div`,{className:`flex justify-between items-start pr-8`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`h4`,{className:`font-bold text-gray-900`,children:e.name}),(0,v.jsx)(`p`,{className:`text-sm text-gray-500 mt-1`,children:e.description})]}),(0,v.jsxs)(`div`,{className:`text-right`,children:[(0,v.jsxs)(`span`,{className:`text-xl font-bold text-indigo-600`,children:[`$`,e.price]}),(0,v.jsxs)(`span`,{className:`text-xs text-gray-500 block`,children:[`/ `,e.duration_days,` days`]})]})]}),y===e.id&&(0,v.jsx)(`div`,{className:`absolute top-1/2 -translate-y-1/2 right-3 w-5 h-5 bg-indigo-600 rounded-full flex items-center justify-center`,children:(0,v.jsx)(t,{className:`w-3 h-3 text-white`})})]},e.id))})]}),(0,v.jsxs)(d,{children:[(0,v.jsxs)(s,{className:`pb-3`,children:[(0,v.jsxs)(l,{className:`text-base flex items-center gap-2`,children:[(0,v.jsx)(h,{className:`w-5 h-5`}),i(`subscription.scan_qr`)]}),(0,v.jsx)(u,{children:i(`subscription.qr_desc`)})]}),(0,v.jsxs)(c,{className:`space-y-4`,children:[(0,v.jsx)(`div`,{className:`bg-white rounded-lg p-4 border border-gray-200 flex items-center justify-center max-w-[280px] mx-auto`,children:(0,v.jsx)(`img`,{src:`/wechat-pay.jpg`,alt:`WeChat Pay QR Code`,className:`w-full h-auto rounded-lg`})}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(`label`,{className:`text-sm font-medium text-gray-700`,children:i(`subscription.transaction_id`)}),(0,v.jsx)(m,{placeholder:i(`subscription.transaction_id_placeholder`),value:x,onChange:e=>S(e.target.value)})]})]})]}),(0,v.jsx)(p,{className:`w-full h-12 text-lg`,disabled:T||!y||!x.trim(),onClick:async()=>{if(!(!y||!x.trim())){E(!0);try{await _.createOrder({plan_id:y,payment_remark:x}),O(!0)}catch(e){console.error(`Failed to create order`,e),alert(i(`subscription.error`))}finally{E(!1)}}},children:i(T?`subscription.submitting`:`subscription.submit`)})]})]})}export{y as default};